<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <script>
const display_width = 1280;
const display_height = 720;
const button_width = 80;
const button_height = 83;
const button_dx = -46;

var legends = {
  'bloodhound': {
    'img': null,
    'x': 783, 'y': 187,
    'enabled': false,
  },
  'gibraltar': {
    'img': null,
    'x': 863, 'y': 187,
    'enabled': false,
  },
  'lifeline': {
    'img': null,
    'x': 943, 'y': 187,
    'enabled': false,
  },
  'pathfinder': {
    'img': null,
    'x': 1023, 'y': 187,
    'enabled': false,
  },
  'wraith': {
    'img': null,
    'x': 1103, 'y': 187,
    'enabled': false,
  },
  'bangalore': {
    'img': null,
    'x': 756, 'y': 271,
    'enabled': false,
  },
  'caustic': {
    'img': null,
    'x': 836, 'y': 271,
    'enabled': false,
  },
  'mirage': {
    'img': null,
    'x': 916, 'y': 271,
    'enabled': false,
  },
  'octane': {
    'img': null,
    'x': 996, 'y': 271,
    'enabled': false,
  },
  'wattson': {
    'img': null,
    'x': 1076, 'y': 271,
    'enabled': false,
  },
  'crypto': {
    'img': null,
    'x': 729, 'y': 355,
    'enabled': false,
  },
  'revenant': {
    'img': null,
    'x': 809, 'y': 355,
    'enabled': false,
  },
  'loba': {
    'img': null,
    'x': 889, 'y': 355,
    'enabled': false,
  },
  'rampart': {
    'img': null,
    'x': 969, 'y': 355,
    'enabled': false,
  },
  'horizon': {
    'img': null,
    'x': 1049, 'y': 355,
    'enabled': false,
  },
  'fuse': {
    'img': null,
    'x': 703, 'y': 439,
    'enabled': false,
  },
  'valkyrie': {
    'img': null,
    'x': 783, 'y': 439,
    'enabled': false,
  },
  'seer': {
    'img': null,
    'x': 863, 'y': 439,
    'enabled': false,
  },
  'ash': {
    'img': null,
    'x': 943, 'y': 439,
    'enabled': false,
  },
  'mad-maggie': {
    'img': null,
    'x': 1023, 'y': 439,
    'enabled': false,
  },
};

var background = {
  'img': null,
  'enabled': false,
};

var spin = {
  'img': null,
  'x': 1103, 'y': 439,
  'enabled': false,
};

const DORMANT_STATE = 1;
const READY_STATE = 2;
const SPINNING_STATE = 3;
var current_state = DORMANT_STATE;


function load_image(context, name) {
  var img = new Image();
  img.addEventListener('load', function() {
    context.drawImage(img, 0, 0, display_width, display_height);
    legends[name].enabled = true;
  }, false);
  img.src = "img/" + name + ".png";
  return img;
}

function draw_blank(context, x, y) {
  context.beginPath();
  context.moveTo(x, y);
  context.lineTo(x+button_width, y);
  context.lineTo(x+button_width+button_dx, y+button_height);
  context.lineTo(x+button_dx, y+button_height);
  context.lineTo(x, y);
  context.closePath();
  context.fillStyle = "#ff00ff";
  context.fill();
}

function test_inside(obj, x, y) {
  // TODO determine whether (x, y) is within the rhombus anchored to obj.
}

function handle_click(e) {
  // TODO check current state, handle state transitions
  console.log("click event at (" + e.clientX + "," + e.clientY + ")");
}

function dormant_state() {
  // TODO display nothing; click handler moves to ready_state
}

function ready_state() {
  // TODO display "????" spin button,
  // begin animation of displaying legends in greyscale
}

function spinning_state() {
  // 
}

var start = function() {
  var overlay = document.getElementById('overlay');
  if (!overlay.getContext) {
    alert('There is something wrong with the <canvas> element.');
    return;
  }
  overlay.width = display_width;
  overlay.height = display_height;
  overlay.addEventListener('click', handle_click, false);

  var context = overlay.getContext('2d');
  if (!background.img) background.img = load_image(context, 'all-legends-greyscale');
  for (const [name, value] of Object.entries(legends)) {
    if (!value.img) legends[name].img = load_image(context, name);
  }
  if (!spin.img) spin.img = load_image(context, 'spin');
}
    </script>
  </head>

  <body onload="start();" style="border:0;margin:0;">
    <canvas id="overlay" style="border:0;padding:0;">
      Hmm... something is keeping your browser from including the CANVAS element in the DOM.
    </canvas>
  </body>
</html>